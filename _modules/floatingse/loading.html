
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>floatingse.loading &#8212; FloatingSE 1.0.0 documentation</title>
    <link rel="stylesheet" href="../../_static/nrel.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../../index.html">FloatingSE 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for floatingse.loading</h1><div class="highlight"><pre>
<span></span>
<span class="kn">from</span> <span class="nn">openmdao.api</span> <span class="k">import</span> <span class="n">Component</span><span class="p">,</span> <span class="n">Group</span><span class="p">,</span> <span class="n">IndepVarComp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pyframe3dd.frame3dd</span> <span class="k">as</span> <span class="nn">frame3dd</span>
<span class="kn">from</span> <span class="nn">commonse.utilities</span> <span class="k">import</span> <span class="n">nodal2sectional</span>

<span class="kn">from</span> <span class="nn">commonse</span> <span class="k">import</span> <span class="n">gravity</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">Tube</span><span class="p">,</span> <span class="n">NFREQ</span>
<span class="kn">import</span> <span class="nn">commonse.UtilizationSupplement</span> <span class="k">as</span> <span class="nn">util</span>
<span class="kn">from</span> <span class="nn">commonse.WindWaveDrag</span> <span class="k">import</span> <span class="n">AeroHydroLoads</span><span class="p">,</span> <span class="n">CylinderWindDrag</span><span class="p">,</span> <span class="n">CylinderWaveDrag</span>
<span class="kn">from</span> <span class="nn">commonse.environment</span> <span class="k">import</span> <span class="n">WaveBase</span><span class="p">,</span> <span class="n">PowerWind</span>
<span class="kn">from</span> <span class="nn">commonse.vertical_cylinder</span> <span class="k">import</span> <span class="n">CylinderDiscretization</span><span class="p">,</span> <span class="n">CylinderMass</span>
<span class="kn">from</span> <span class="nn">.map_mooring</span> <span class="k">import</span> <span class="n">NLINES_MAX</span>


<span class="k">def</span> <span class="nf">find_nearest</span><span class="p">(</span><span class="n">array</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">array</span><span class="o">-</span><span class="n">value</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span> 


<div class="viewcode-block" id="FloatingFrame"><a class="viewcode-back" href="../../package.html#floatingse.loading.FloatingFrame">[docs]</a><span class="k">class</span> <span class="nc">FloatingFrame</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    OpenMDAO Component class for semisubmersible pontoon / truss structure for floating offshore wind turbines.</span>
<span class="sd">    Should be tightly coupled with Semi and Mooring classes for full system representation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nFull</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">FloatingFrame</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Environment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;water_density&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg/m**3&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;density of water&#39;</span><span class="p">)</span>

        <span class="c1"># Material properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;material_density&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg/m**3&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;density of material&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Pa&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Modulus of elasticity (Youngs) of material&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Pa&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Shear modulus of material&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;yield_stress&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Pa&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;yield stress of material&#39;</span><span class="p">)</span>

        <span class="c1"># Base column</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;main_z_full&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nFull</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;z-coordinates of section nodes (length = nsection+1)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;main_d_full&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nFull</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;outer radius at each section node bottom to top (length = nsection + 1)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;main_t_full&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nFull</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;shell wall thickness at each section node bottom to top (length = nsection + 1)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;main_mass&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nFull</span><span class="o">-</span><span class="mi">1</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;mass of main column by section&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;main_buckling_length&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nFull</span><span class="o">-</span><span class="mi">1</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;distance between ring stiffeners&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;main_displaced_volume&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nFull</span><span class="o">-</span><span class="mi">1</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m**3&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;column volume of water displaced by section&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;main_hydrostatic_force&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nFull</span><span class="o">-</span><span class="mi">1</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Net z-force of hydrostatic pressure by section&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;main_center_of_buoyancy&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;z-position of center of column buoyancy force&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;main_center_of_mass&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;z-position of center of column mass&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;main_Px&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N/m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;force per unit length in x-direction on main&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;main_Py&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N/m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;force per unit length in y-direction on main&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;main_Pz&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N/m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;force per unit length in z-direction on main&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;main_qdyn&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N/m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;dynamic pressure on main&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;main_pontoon_attach_upper&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Fraction of main column for upper truss attachment on main column&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;main_pontoon_attach_lower&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Fraction of main column lower truss attachment on main column&#39;</span><span class="p">)</span>

        <span class="c1"># offset columns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;offset_z_full&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nFull</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;z-coordinates of section nodes (length = nsection+1)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;offset_d_full&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nFull</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;outer radius at each section node bottom to top (length = nsection + 1)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;offset_t_full&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nFull</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;shell wall thickness at each section node bottom to top (length = nsection + 1)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;offset_mass&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nFull</span><span class="o">-</span><span class="mi">1</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;mass of offset column by section&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;offset_buckling_length&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nFull</span><span class="o">-</span><span class="mi">1</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;distance between ring stiffeners&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;offset_displaced_volume&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nFull</span><span class="o">-</span><span class="mi">1</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m**3&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;column volume of water displaced by section&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;offset_hydrostatic_force&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nFull</span><span class="o">-</span><span class="mi">1</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Net z-force of hydrostatic pressure by section&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;offset_center_of_buoyancy&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;z-position of center of column buoyancy force&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;offset_center_of_mass&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;z-position of center of column mass&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;offset_Px&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N/m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;force per unit length in x-direction on offset&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;offset_Py&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N/m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;force per unit length in y-direction on offset&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;offset_Pz&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N/m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;force per unit length in z-direction on offset&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;offset_qdyn&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N/m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;dynamic pressure on offset&#39;</span><span class="p">)</span>

        <span class="c1"># Tower</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;tower_z_full&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nFull</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;z-coordinates of section nodes (length = nsection+1)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;tower_d_full&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nFull</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;outer radius at each section node bottom to top (length = nsection + 1)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;tower_t_full&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nFull</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;shell wall thickness at each section node bottom to top (length = nsection + 1)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;tower_mass_section&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nFull</span><span class="o">-</span><span class="mi">1</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;mass of tower column by section&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;tower_buckling_length&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;buckling length&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;tower_center_of_mass&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;z-position of center of tower mass&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;tower_Px&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N/m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;force per unit length in x-direction on tower&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;tower_Py&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N/m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;force per unit length in y-direction on tower&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;tower_Pz&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N/m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;force per unit length in z-direction on tower&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;tower_qdyn&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N/m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;dynamic pressure on tower&#39;</span><span class="p">)</span>
        
        <span class="c1"># Semi geometry</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;radius_to_offset_column&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Distance from main column centerpoint to offset column centerpoint&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;number_of_offset_columns&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Number of offset columns evenly spaced around main column&#39;</span><span class="p">)</span>

        <span class="c1"># Pontoon properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;pontoon_outer_diameter&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Outer radius of tubular pontoon that connects offset or main columns&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;pontoon_wall_thickness&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Inner radius of tubular pontoon that connects offset or main columns&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;cross_attachment_pontoons&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Inclusion of pontoons that connect the bottom of the central main to the tops of the outer offset columns&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;lower_attachment_pontoons&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Inclusion of pontoons that connect the central main to the outer offset columns at their bottoms&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;upper_attachment_pontoons&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Inclusion of pontoons that connect the central main to the outer offset columns at their tops&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;lower_ring_pontoons&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Inclusion of pontoons that ring around outer offset columns at their bottoms&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;upper_ring_pontoons&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Inclusion of pontoons that ring around outer offset columns at their tops&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;outer_cross_pontoons&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Inclusion of pontoons that ring around outer offset columns at their tops&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1"># Turbine parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;rna_mass&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;mass of tower&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;rna_cg&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Location of RNA center of mass relative to tower top&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;rna_force&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Force in xyz-direction on turbine&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;rna_moment&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Moments about turbine main&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;rna_I&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Moments about turbine main&#39;</span><span class="p">)</span>

        <span class="c1"># Mooting parameters for loading</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;number_of_mooring_connections&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;number of mooring connections on vessel&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;mooring_lines_per_connection&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;number of mooring lines per connection&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;mooring_neutral_load&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">NLINES_MAX</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;z-force of mooring lines on structure&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;mooring_stiffness&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N/m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Linearized stiffness matrix of mooring system at neutral (no offset) conditions.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;mooring_moments_of_inertia&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;mass moment of inertia of mooring system about fairlead-centerline point [xx yy zz xy xz yz]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;fairlead&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Depth below water for mooring line attachment&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;fairlead_radius&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Radius from center of structure to fairlead connection points&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;fairlead_support_outer_diameter&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">desc</span><span class="o">=</span><span class="s1">&#39;fairlead support outer diameter&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;fairlead_support_wall_thickness&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">desc</span><span class="o">=</span><span class="s1">&#39;fairlead support wall thickness&#39;</span><span class="p">)</span>
        
        <span class="c1"># safety factors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;gamma_f&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;safety factor on loads&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;gamma_m&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;safety factor on materials&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;gamma_n&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;safety factor on consequence of failure&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;gamma_b&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;buckling safety factor&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;gamma_fatigue&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;total safety factor for fatigue&#39;</span><span class="p">)</span>

        <span class="c1"># Manufacturing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;connection_ratio_max&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Maximum ratio of pontoon outer diameter to main/offset outer diameter&#39;</span><span class="p">)</span>
        
        <span class="c1"># Costing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;pontoon_cost_rate&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">6.250</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;USD/kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Finished cost rate of truss components&#39;</span><span class="p">)</span>
        
        <span class="c1"># Outputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;pontoon_cost&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;USD&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Cost of pontoon elements and connecting truss&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;pontoon_mass&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Mass of pontoon elements and connecting truss&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;pontoon_displacement&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m**3&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Buoyancy force of submerged pontoon elements&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;pontoon_center_of_buoyancy&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;z-position of center of pontoon buoyancy force&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;pontoon_center_of_mass&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;z-position of center of pontoon mass&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;top_deflection&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Deflection of tower top in yaw-aligned +x direction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;pontoon_stress&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">70</span><span class="p">,)),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Utilization (&lt;1) of von Mises stress by yield stress and safety factor for all pontoon elements&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;main_stress&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Von Mises stress utilization along main column at specified locations. Incudes safety factor.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;main_stress:axial&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Axial stress along main column at specified locations.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;main_stress:shear&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Shear stress along main column at specified locations.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;main_stress:hoop&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Hoop stress along main column at specified locations.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;main_stress:hoopStiffen&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Hoop stress along main column at specified locations.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;main_shell_buckling&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Shell buckling constraint. Should be &lt; 1 for feasibility. Includes safety factors&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;main_global_buckling&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Global buckling constraint. Should be &lt; 1 for feasibility. Includes safety factors&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;offset_stress&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Von Mises stress utilization along offset column at specified locations. Incudes safety factor.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;offset_stress:axial&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Axial stress along offset column at specified locations.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;offset_stress:shear&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Shear stress along offset column at specified locations.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;offset_stress:hoop&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Hoop stress along offset column at specified locations.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;offset_stress:hoopStiffen&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Hoop stress along offset column at specified locations.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;offset_shell_buckling&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Shell buckling constraint. Should be &lt; 1 for feasibility. Includes safety factors&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;offset_global_buckling&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Global buckling constraint. Should be &lt; 1 for feasibility. Includes safety factors&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;tower_stress&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Von Mises stress utilization along tower at specified locations.  incudes safety factor.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;tower_stress:axial&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Axial stress along tower column at specified locations.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;tower_stress:shear&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Shear stress along tower column at specified locations.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;tower_stress:hoop&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Hoop stress along tower column at specified locations.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;tower_stress:hoopStiffen&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Hoop stress along tower column at specified locations.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;tower_shell_buckling&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Shell buckling constraint.  Should be &lt; 1 for feasibility.  Includes safety factors&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;tower_global_buckling&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Global buckling constraint.  Should be &lt; 1 for feasibility.  Includes safety factors&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;plot_matrix&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Ratio of shear stress to yield stress for all pontoon elements&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;main_connection_ratio&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nFull</span><span class="p">,)),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Ratio of pontoon outer diameter to main outer diameter&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;offset_connection_ratio&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nFull</span><span class="p">,)),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Ratio of pontoon outer diameter to main outer diameter&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;structural_frequencies&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NFREQ</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Hz&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;First six natural frequencies&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;substructure_mass&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Mass of substructure elements and connecting truss&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;structural_mass&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Mass of whole turbine except for mooring lines&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;total_displacement&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m**3&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Total volume of water displaced by floating turbine (except for mooring lines)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;z_center_of_buoyancy&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;z-position of center of buoyancy of whole turbine&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;substructure_center_of_mass&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;xyz-position of center of gravity of substructure only&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;structure_center_of_mass&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;xyz-position of center of gravity of whole turbine&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;total_force&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Net forces on turbine&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;total_moment&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Moments on whole turbine&#39;</span><span class="p">)</span>
        
        <span class="c1"># Derivatives</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;fd&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;central&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;check_form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;central&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;step_calc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;relative&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;step_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-5</span>
         
    <span class="k">def</span> <span class="nf">solve_nonlinear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>
        <span class="c1"># If something fails, we have to tell the optimizer this design is no good</span>
        <span class="k">def</span> <span class="nf">bad_input</span><span class="p">():</span>
            <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;structural_frequencies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e30</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">NFREQ</span><span class="p">)</span>
            <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;top_deflection&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e30</span>
            <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;substructure_mass&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="mf">1e30</span>
            <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;structural_mass&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="mf">1e30</span>
            <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;total_displacement&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e30</span>
            <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;z_center_of_buoyancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;substructure_center_of_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e30</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;structure_center_of_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e30</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;total_force&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">1e30</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;total_moment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e30</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;tower_stress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e30</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">m_main</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;tower_shell_buckling&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e30</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">m_main</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;tower_global_buckling&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e30</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">m_main</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="c1"># Unpack variables</span>
        <span class="n">ncolumn</span>         <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;number_of_offset_columns&#39;</span><span class="p">])</span>
        <span class="n">crossAttachFlag</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;cross_attachment_pontoons&#39;</span><span class="p">]</span>
        <span class="n">lowerAttachFlag</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;lower_attachment_pontoons&#39;</span><span class="p">]</span>
        <span class="n">upperAttachFlag</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;upper_attachment_pontoons&#39;</span><span class="p">]</span>
        <span class="n">lowerRingFlag</span>   <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;lower_ring_pontoons&#39;</span><span class="p">]</span>
        <span class="n">upperRingFlag</span>   <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;upper_ring_pontoons&#39;</span><span class="p">]</span>
        <span class="n">outerCrossFlag</span>  <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;outer_cross_pontoons&#39;</span><span class="p">]</span>
        
        <span class="n">R_semi</span>         <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;radius_to_offset_column&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">ncolumn</span><span class="o">&gt;</span><span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>
        <span class="n">R_od_pontoon</span>   <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;pontoon_outer_diameter&#39;</span><span class="p">]</span>
        <span class="n">R_od_main</span>      <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;main_d_full&#39;</span><span class="p">]</span>
        <span class="n">R_od_offset</span>   <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;offset_d_full&#39;</span><span class="p">]</span>
        <span class="n">R_od_tower</span>     <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;tower_d_full&#39;</span><span class="p">]</span>
        <span class="n">R_od_fairlead</span>  <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;fairlead_support_outer_diameter&#39;</span><span class="p">]</span>

        <span class="n">t_wall_main</span>     <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;main_t_full&#39;</span><span class="p">]</span>
        <span class="n">t_wall_offset</span>  <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;offset_t_full&#39;</span><span class="p">]</span>
        <span class="n">t_wall_pontoon</span>  <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pontoon_wall_thickness&#39;</span><span class="p">]</span>
        <span class="n">t_wall_tower</span>    <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;tower_t_full&#39;</span><span class="p">]</span>
        <span class="n">t_wall_fairlead</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;fairlead_support_wall_thickness&#39;</span><span class="p">]</span>

        <span class="n">E</span>              <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span>
        <span class="n">G</span>              <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">]</span>
        <span class="n">rho</span>            <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;material_density&#39;</span><span class="p">]</span>
        <span class="n">sigma_y</span>        <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;yield_stress&#39;</span><span class="p">]</span>
        
        <span class="n">z_main</span>         <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;main_z_full&#39;</span><span class="p">]</span>
        <span class="n">z_offset</span>      <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;offset_z_full&#39;</span><span class="p">]</span>
        <span class="n">z_tower</span>        <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;tower_z_full&#39;</span><span class="p">]</span>
        <span class="n">z_attach_upper</span> <span class="o">=</span> <span class="n">z_main</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">upperAttachFlag</span> <span class="k">else</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;main_pontoon_attach_upper&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">z_main</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">z_main</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">z_main</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">z_attach_lower</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;main_pontoon_attach_lower&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">z_main</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">z_main</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">z_main</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">z_fairlead</span>     <span class="o">=</span> <span class="o">-</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;fairlead&#39;</span><span class="p">]</span>
        
        <span class="n">m_main</span>         <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;main_mass&#39;</span><span class="p">]</span>
        <span class="n">m_offset</span>      <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;offset_mass&#39;</span><span class="p">]</span>
        <span class="n">m_tower</span>        <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;tower_mass_section&#39;</span><span class="p">]</span>
        
        <span class="n">m_rna</span>          <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rna_mass&#39;</span><span class="p">]</span>
        <span class="n">F_rna</span>          <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rna_force&#39;</span><span class="p">]</span>
        <span class="n">M_rna</span>          <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rna_moment&#39;</span><span class="p">]</span>
        <span class="n">I_rna</span>          <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rna_I&#39;</span><span class="p">]</span>
        <span class="n">cg_rna</span>         <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rna_cg&#39;</span><span class="p">]</span>
        
        <span class="n">rhoWater</span>       <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;water_density&#39;</span><span class="p">]</span>
        
        <span class="n">V_main</span>         <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;main_displaced_volume&#39;</span><span class="p">]</span>
        <span class="n">V_offset</span>      <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;offset_displaced_volume&#39;</span><span class="p">]</span>

        <span class="n">F_hydro_main</span>    <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;main_hydrostatic_force&#39;</span><span class="p">]</span>
        <span class="n">F_hydro_offset</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;offset_hydrostatic_force&#39;</span><span class="p">]</span>

        <span class="n">z_cb_main</span>      <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;main_center_of_buoyancy&#39;</span><span class="p">]</span>
        <span class="n">z_cb_offset</span>   <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;offset_center_of_buoyancy&#39;</span><span class="p">]</span>
        
        <span class="n">cg_main</span>        <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;main_center_of_mass&#39;</span><span class="p">]]</span>
        <span class="n">cg_offset</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;offset_center_of_mass&#39;</span><span class="p">]]</span>
        <span class="n">cg_tower</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;tower_center_of_mass&#39;</span><span class="p">]]</span>
        
        <span class="n">coeff</span>          <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pontoon_cost_rate&#39;</span><span class="p">]</span>

        <span class="n">n_connect</span>      <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;number_of_mooring_connections&#39;</span><span class="p">])</span>
        <span class="n">n_lines</span>        <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;mooring_lines_per_connection&#39;</span><span class="p">])</span>
        <span class="n">K_mooring</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;mooring_stiffness&#39;</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">I_mooring</span>      <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;mooring_moments_of_inertia&#39;</span><span class="p">]</span>
        <span class="n">F_mooring</span>      <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;mooring_neutral_load&#39;</span><span class="p">]</span>
        <span class="n">R_fairlead</span>     <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;fairlead_radius&#39;</span><span class="p">]</span>
        
        <span class="n">gamma_f</span>        <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;gamma_f&#39;</span><span class="p">]</span>
        <span class="n">gamma_m</span>        <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;gamma_m&#39;</span><span class="p">]</span>
        <span class="n">gamma_n</span>        <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;gamma_n&#39;</span><span class="p">]</span>
        <span class="n">gamma_b</span>        <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;gamma_b&#39;</span><span class="p">]</span>
        <span class="n">gamma_fatigue</span>  <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;gamma_fatigue&#39;</span><span class="p">]</span>

        <span class="c1"># Quick ratio for unknowns</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;main_connection_ratio&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;connection_ratio_max&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">R_od_pontoon</span><span class="o">/</span><span class="n">R_od_main</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;offset_connection_ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;connection_ratio_max&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">R_od_pontoon</span><span class="o">/</span><span class="n">R_od_offset</span>

        <span class="c1"># --- INPUT CHECKS -----</span>
        <span class="c1"># There is no truss if not offset columns</span>
        <span class="k">if</span> <span class="n">ncolumn</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">crossAttachFlag</span> <span class="o">=</span> <span class="n">lowerAttachFlag</span> <span class="o">=</span> <span class="n">upperAttachFlag</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">lowerRingFlag</span> <span class="o">=</span> <span class="n">upperRingFlag</span> <span class="o">=</span> <span class="n">outerCrossFlag</span>  <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Must have symmetry for the substructure to work out</span>
        <span class="k">if</span> <span class="n">ncolumn</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">or</span> <span class="n">ncolumn</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">:</span>
            <span class="n">bad_input</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="c1"># Must have symmetry in moorning loading too</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ncolumn</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">n_connect</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ncolumn</span> <span class="o">!=</span> <span class="n">n_connect</span><span class="p">):</span>
            <span class="n">bad_input</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="c1"># If there are offset columns, must have attachment pontoons (only have ring pontoons doesn&#39;t make sense)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ncolumn</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">crossAttachFlag</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">lowerAttachFlag</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">upperAttachFlag</span><span class="p">):</span>
            <span class="n">bad_input</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="c1"># Must have lower ring if have cross braces</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ncolumn</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">outerCrossFlag</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">lowerRingFlag</span><span class="p">):</span>
            <span class="n">bad_input</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="c1"># ---GEOMETRY---</span>
        <span class="c1"># Compute frustum angles</span>
        <span class="n">angle_tower</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">R_od_tower</span><span class="p">)</span>   <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">z_tower</span><span class="p">)</span>   <span class="p">)</span>
        <span class="n">angle_main</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">R_od_main</span><span class="p">)</span>    <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">z_main</span><span class="p">)</span>    <span class="p">)</span>
        <span class="n">angle_offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">R_od_offset</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">z_offset</span><span class="p">)</span> <span class="p">)</span>
        
        <span class="c1"># ---NODES---</span>
        <span class="c1"># Add nodes for main column: Using 4 nodes/3 elements per section</span>
        <span class="c1"># Make sure there is a node at upper and lower attachment points</span>
        <span class="n">mainBeginID</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">ncolumn</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">find_nearest</span><span class="p">(</span><span class="n">z_main</span><span class="p">,</span> <span class="n">z_attach_lower</span><span class="p">)</span>
            <span class="n">z_main</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_attach_lower</span>
            <span class="n">mainLowerID</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span>
            
            <span class="n">idx</span> <span class="o">=</span> <span class="n">find_nearest</span><span class="p">(</span><span class="n">z_main</span><span class="p">,</span> <span class="n">z_attach_upper</span><span class="p">)</span>
            <span class="n">z_main</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_attach_upper</span>
            <span class="n">mainUpperID</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span>
        
        <span class="n">mainEndID</span> <span class="o">=</span> <span class="n">z_main</span><span class="o">.</span><span class="n">size</span>
        <span class="n">freeboard</span> <span class="o">=</span> <span class="n">z_main</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">fairleadID</span>  <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Need mooring attachment point if just running a spar</span>
        <span class="k">if</span> <span class="n">ncolumn</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">find_nearest</span><span class="p">(</span><span class="n">z_main</span><span class="p">,</span> <span class="n">z_fairlead</span><span class="p">)</span>
            <span class="n">z_main</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_fairlead</span>
            <span class="n">fairleadID</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span>
        
        <span class="n">znode</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span> <span class="n">z_main</span> <span class="p">)</span>
        <span class="n">xnode</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">znode</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">ynode</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">znode</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">rnode</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span> <span class="n">R_od_main</span><span class="p">)</span>

        <span class="n">towerBeginID</span> <span class="o">=</span> <span class="n">mainEndID</span>
        <span class="n">myz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_tower</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">xnode</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xnode</span><span class="p">,</span> <span class="n">myz</span><span class="p">)</span>
        <span class="n">ynode</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ynode</span><span class="p">,</span> <span class="n">myz</span><span class="p">)</span>
        <span class="n">znode</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">znode</span><span class="p">,</span> <span class="n">z_tower</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">freeboard</span> <span class="p">)</span>
        <span class="n">rnode</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rnode</span><span class="p">,</span> <span class="n">R_od_tower</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">towerEndID</span> <span class="o">=</span> <span class="n">xnode</span><span class="o">.</span><span class="n">size</span>

        <span class="c1"># Create dummy node so that the tower isn&#39;t the last in a chain.</span>
        <span class="c1"># This avoids a Frame3DD bug</span>
        <span class="n">dummyID</span> <span class="o">=</span> <span class="n">xnode</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">xnode</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xnode</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">ynode</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ynode</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">znode</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">znode</span><span class="p">,</span> <span class="n">znode</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">1.0</span> <span class="p">)</span>
        <span class="n">rnode</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rnode</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        
        <span class="c1"># Get x and y positions of surrounding offset columns</span>
        <span class="n">offsetLowerID</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">offsetUpperID</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">offsetx</span> <span class="o">=</span> <span class="n">R_semi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">ncolumn</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">offsety</span> <span class="o">=</span> <span class="n">R_semi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">ncolumn</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">offsetx</span> <span class="o">=</span> <span class="n">offsetx</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">offsety</span> <span class="o">=</span> <span class="n">offsety</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Add in offset column nodes around the circle, make sure there is a node at the fairlead</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">find_nearest</span><span class="p">(</span><span class="n">z_offset</span><span class="p">,</span> <span class="n">z_fairlead</span><span class="p">)</span>
        <span class="n">myones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">z_offset</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncolumn</span><span class="p">):</span>
            <span class="n">offsetLowerID</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">xnode</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span>
            <span class="n">fairleadID</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">xnode</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span>
            <span class="n">xnode</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xnode</span><span class="p">,</span> <span class="n">offsetx</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">myones</span><span class="p">)</span>
            <span class="n">ynode</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ynode</span><span class="p">,</span> <span class="n">offsety</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">myones</span><span class="p">)</span>
            <span class="n">znode</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">znode</span><span class="p">,</span> <span class="n">z_offset</span> <span class="p">)</span>
            <span class="n">rnode</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rnode</span><span class="p">,</span> <span class="n">R_od_offset</span> <span class="p">)</span>
            <span class="n">offsetUpperID</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">xnode</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>

        <span class="c1"># Add nodes where mooring lines attach, which may be offset from columns</span>
        <span class="n">mooringx</span>  <span class="o">=</span> <span class="n">R_fairlead</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">n_connect</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">mooringy</span>  <span class="o">=</span> <span class="n">R_fairlead</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">n_connect</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">mooringID</span> <span class="o">=</span> <span class="n">xnode</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_connect</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">xnode</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xnode</span><span class="p">,</span> <span class="n">mooringx</span><span class="p">)</span>
        <span class="n">ynode</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ynode</span><span class="p">,</span> <span class="n">mooringy</span><span class="p">)</span>
        <span class="n">znode</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">znode</span><span class="p">,</span> <span class="n">z_fairlead</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_connect</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">rnode</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rnode</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            
        <span class="c1"># Add nodes midway around outer ring for cross bracing</span>
        <span class="k">if</span> <span class="n">outerCrossFlag</span> <span class="ow">and</span> <span class="n">ncolumn</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">crossx</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">offsetx</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">offsetx</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">crossy</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">offsety</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">offsety</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

            <span class="n">crossOuterLowerID</span> <span class="o">=</span> <span class="n">xnode</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ncolumn</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">xnode</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xnode</span><span class="p">,</span> <span class="n">crossx</span><span class="p">)</span>
            <span class="n">ynode</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ynode</span><span class="p">,</span> <span class="n">crossy</span><span class="p">)</span>
            <span class="n">znode</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">znode</span><span class="p">,</span> <span class="n">z_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">ncolumn</span><span class="p">))</span>
            <span class="n">rnode</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rnode</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

            <span class="c1">#crossOuterUpperID = xnode.size + np.arange(ncolumn) + 1</span>
            <span class="c1">#xnode = np.append(xnode, crossx)</span>
            <span class="c1">#ynode = np.append(ynode, crossy)</span>
            <span class="c1">#znode = np.append(znode, z_offset[-1]*np.ones(ncolumn))</span>

        <span class="c1"># Create Node Data object</span>
        <span class="n">nnode</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">xnode</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">rnode</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">xnode</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="c1"># z-spacing too narrow for use of rnodes</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">frame3dd</span><span class="o">.</span><span class="n">NodeData</span><span class="p">(</span><span class="n">nnode</span><span class="p">,</span> <span class="n">xnode</span><span class="p">,</span> <span class="n">ynode</span><span class="p">,</span> <span class="n">znode</span><span class="p">,</span> <span class="n">rnode</span><span class="p">)</span>

        

        <span class="c1"># ---ELEMENTS / EDGES---</span>
        <span class="n">N1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">N2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="c1"># Lower connection from central main column to offset columns</span>
        <span class="k">if</span> <span class="n">lowerAttachFlag</span><span class="p">:</span>
            <span class="n">lowerAttachEID</span> <span class="o">=</span> <span class="n">N1</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncolumn</span><span class="p">):</span>
                <span class="n">N1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N1</span><span class="p">,</span> <span class="n">mainLowerID</span> <span class="p">)</span>
                <span class="n">N2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N2</span><span class="p">,</span> <span class="n">offsetLowerID</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="p">)</span>
        <span class="c1"># Upper connection from central main column to offset columns</span>
        <span class="k">if</span> <span class="n">upperAttachFlag</span><span class="p">:</span>
            <span class="n">upperAttachEID</span> <span class="o">=</span> <span class="n">N1</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncolumn</span><span class="p">):</span>
                <span class="n">N1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N1</span><span class="p">,</span> <span class="n">mainUpperID</span> <span class="p">)</span>
                <span class="n">N2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N2</span><span class="p">,</span> <span class="n">offsetUpperID</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="p">)</span>
        <span class="c1"># Cross braces from lower central main column to upper offset columns</span>
        <span class="k">if</span> <span class="n">crossAttachFlag</span><span class="p">:</span>
            <span class="n">crossAttachEID</span> <span class="o">=</span> <span class="n">N1</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncolumn</span><span class="p">):</span>
                <span class="n">N1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N1</span><span class="p">,</span> <span class="n">mainLowerID</span> <span class="p">)</span>
                <span class="n">N2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N2</span><span class="p">,</span> <span class="n">offsetUpperID</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="p">)</span>
            <span class="c1"># Will be used later to convert from local member c.s. to global</span>
            <span class="n">cross_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span> <span class="p">(</span><span class="n">z_attach_upper</span> <span class="o">-</span> <span class="n">z_attach_lower</span><span class="p">)</span> <span class="o">/</span> <span class="n">R_semi</span> <span class="p">)</span>
        <span class="c1"># Lower ring around offset columns</span>
        <span class="k">if</span> <span class="n">lowerRingFlag</span><span class="p">:</span>
            <span class="n">lowerRingEID</span> <span class="o">=</span> <span class="n">N1</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncolumn</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">N1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N1</span><span class="p">,</span> <span class="n">offsetLowerID</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="p">)</span>
                <span class="n">N2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N2</span><span class="p">,</span> <span class="n">offsetLowerID</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">N1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N1</span><span class="p">,</span> <span class="n">offsetLowerID</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">N2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N2</span><span class="p">,</span> <span class="n">offsetLowerID</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
        <span class="c1"># Upper ring around offset columns</span>
        <span class="k">if</span> <span class="n">upperRingFlag</span><span class="p">:</span>
            <span class="n">upperRingEID</span> <span class="o">=</span> <span class="n">N1</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncolumn</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">N1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N1</span><span class="p">,</span> <span class="n">offsetUpperID</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="p">)</span>
                <span class="n">N2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N2</span><span class="p">,</span> <span class="n">offsetUpperID</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">N1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N1</span><span class="p">,</span> <span class="n">offsetUpperID</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">N2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N2</span><span class="p">,</span> <span class="n">offsetUpperID</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
        <span class="c1"># Outer cross braces</span>
        <span class="k">if</span> <span class="n">outerCrossFlag</span><span class="p">:</span>
            <span class="n">outerCrossEID</span> <span class="o">=</span> <span class="n">N1</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncolumn</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">N1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N1</span><span class="p">,</span> <span class="n">crossOuterLowerID</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="p">)</span>
                <span class="n">N2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N2</span><span class="p">,</span> <span class="n">offsetUpperID</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="p">)</span>
                <span class="n">N1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N1</span><span class="p">,</span> <span class="n">crossOuterLowerID</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
                <span class="n">N2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N2</span><span class="p">,</span> <span class="n">offsetUpperID</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">N1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N1</span><span class="p">,</span> <span class="n">crossOuterLowerID</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">N2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N2</span><span class="p">,</span> <span class="n">offsetUpperID</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">N1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N1</span><span class="p">,</span> <span class="n">crossOuterLowerID</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">N2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N2</span><span class="p">,</span> <span class="n">offsetUpperID</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
        <span class="c1"># TODO: Parameterize these for upper, lower, cross connections</span>
        <span class="c1"># Properties for the inner connectors</span>
        <span class="n">mytube</span> <span class="o">=</span> <span class="n">Tube</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">R_od_pontoon</span><span class="p">,</span> <span class="n">t_wall_pontoon</span><span class="p">)</span>
        <span class="n">Ax</span>    <span class="o">=</span> <span class="n">mytube</span><span class="o">.</span><span class="n">Area</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">As</span>    <span class="o">=</span> <span class="n">mytube</span><span class="o">.</span><span class="n">Asx</span>  <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">Jx</span>    <span class="o">=</span> <span class="n">mytube</span><span class="o">.</span><span class="n">J0</span>   <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">I</span>     <span class="o">=</span> <span class="n">mytube</span><span class="o">.</span><span class="n">Jxx</span>  <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">S</span>     <span class="o">=</span> <span class="n">mytube</span><span class="o">.</span><span class="n">S</span>    <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">C</span>     <span class="o">=</span> <span class="n">mytube</span><span class="o">.</span><span class="n">C</span>    <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">modE</span>  <span class="o">=</span> <span class="n">E</span>   <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">modG</span>  <span class="o">=</span> <span class="n">G</span>   <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">roll</span>  <span class="o">=</span> <span class="mf">0.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">dens</span>  <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="c1"># Add in fairlead support elements</span>
        <span class="n">mooringEID</span> <span class="o">=</span> <span class="n">N1</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">mytube</span>  <span class="o">=</span> <span class="n">Tube</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">R_od_fairlead</span><span class="p">,</span> <span class="n">t_wall_fairlead</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_connect</span><span class="p">):</span>
            <span class="n">kfair</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">ncolumn</span><span class="o">==</span><span class="mi">0</span> <span class="k">else</span> <span class="n">k</span>
            <span class="n">N1</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N1</span>  <span class="p">,</span> <span class="n">fairleadID</span><span class="p">[</span><span class="n">kfair</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">N2</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N2</span>  <span class="p">,</span> <span class="n">mooringID</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">Ax</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ax</span>  <span class="p">,</span> <span class="n">mytube</span><span class="o">.</span><span class="n">Area</span> <span class="p">)</span>
            <span class="n">As</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">As</span>  <span class="p">,</span> <span class="n">mytube</span><span class="o">.</span><span class="n">Asx</span> <span class="p">)</span>
            <span class="n">Jx</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Jx</span>  <span class="p">,</span> <span class="n">mytube</span><span class="o">.</span><span class="n">J0</span> <span class="p">)</span>
            <span class="n">I</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span>   <span class="p">,</span> <span class="n">mytube</span><span class="o">.</span><span class="n">Jxx</span> <span class="p">)</span>
            <span class="n">S</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">S</span>   <span class="p">,</span> <span class="n">mytube</span><span class="o">.</span><span class="n">S</span> <span class="p">)</span>
            <span class="n">C</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">C</span>   <span class="p">,</span> <span class="n">mytube</span><span class="o">.</span><span class="n">C</span> <span class="p">)</span>
            <span class="n">modE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modE</span><span class="p">,</span> <span class="n">E</span> <span class="p">)</span>
            <span class="n">modG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modG</span><span class="p">,</span> <span class="n">G</span> <span class="p">)</span>
            <span class="n">roll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">roll</span><span class="p">,</span> <span class="mf">0.0</span> <span class="p">)</span>
            <span class="n">dens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dens</span><span class="p">,</span> <span class="n">rho</span> <span class="p">)</span>
            

        <span class="c1"># Now mock up cylindrical columns as truss members even though long, slender assumption breaks down</span>
        <span class="c1"># Will set density = 0.0 so that we don&#39;t double count the mass</span>
        <span class="c1"># First get geometry in each of the elements</span>
        <span class="n">R_od_main</span><span class="p">,</span><span class="n">_</span>      <span class="o">=</span> <span class="n">nodal2sectional</span><span class="p">(</span> <span class="n">R_od_main</span> <span class="p">)</span>
        <span class="n">t_wall_main</span><span class="p">,</span><span class="n">_</span>    <span class="o">=</span> <span class="n">nodal2sectional</span><span class="p">(</span> <span class="n">t_wall_main</span> <span class="p">)</span>
        <span class="n">R_od_offset</span><span class="p">,</span><span class="n">_</span>   <span class="o">=</span> <span class="n">nodal2sectional</span><span class="p">(</span> <span class="n">R_od_offset</span> <span class="p">)</span>
        <span class="n">t_wall_offset</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">nodal2sectional</span><span class="p">(</span> <span class="n">t_wall_offset</span> <span class="p">)</span>
        <span class="n">R_od_tower</span><span class="p">,</span><span class="n">_</span>     <span class="o">=</span> <span class="n">nodal2sectional</span><span class="p">(</span> <span class="n">R_od_tower</span> <span class="p">)</span>
        <span class="n">t_wall_tower</span><span class="p">,</span><span class="n">_</span>   <span class="o">=</span> <span class="n">nodal2sectional</span><span class="p">(</span> <span class="n">t_wall_tower</span> <span class="p">)</span>
        <span class="c1"># Senu TODO: Make artificially more stiff?</span>
        <span class="n">mainEID</span> <span class="o">=</span> <span class="n">N1</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">mytube</span>  <span class="o">=</span> <span class="n">Tube</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">R_od_main</span><span class="p">,</span> <span class="n">t_wall_main</span><span class="p">)</span>
        <span class="n">myrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">R_od_main</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">myones</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">myrange</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">mydens</span>  <span class="o">=</span> <span class="n">m_main</span> <span class="o">/</span> <span class="n">mytube</span><span class="o">.</span><span class="n">Area</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">z_main</span><span class="p">)</span> <span class="o">+</span> <span class="n">eps</span>
        <span class="n">N1</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N1</span>  <span class="p">,</span> <span class="n">myrange</span> <span class="o">+</span> <span class="n">mainBeginID</span>    <span class="p">)</span>
        <span class="n">N2</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N2</span>  <span class="p">,</span> <span class="n">myrange</span> <span class="o">+</span> <span class="n">mainBeginID</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">Ax</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ax</span>  <span class="p">,</span> <span class="n">mytube</span><span class="o">.</span><span class="n">Area</span> <span class="p">)</span>
        <span class="n">As</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">As</span>  <span class="p">,</span> <span class="n">mytube</span><span class="o">.</span><span class="n">Asx</span> <span class="p">)</span>
        <span class="n">Jx</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Jx</span>  <span class="p">,</span> <span class="n">mytube</span><span class="o">.</span><span class="n">J0</span> <span class="p">)</span>
        <span class="n">I</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span>   <span class="p">,</span> <span class="n">mytube</span><span class="o">.</span><span class="n">Jxx</span> <span class="p">)</span>
        <span class="n">S</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">S</span>   <span class="p">,</span> <span class="n">mytube</span><span class="o">.</span><span class="n">S</span> <span class="p">)</span>
        <span class="n">C</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">C</span>   <span class="p">,</span> <span class="n">mytube</span><span class="o">.</span><span class="n">C</span> <span class="p">)</span>
        <span class="n">modE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modE</span><span class="p">,</span> <span class="n">E</span><span class="o">*</span><span class="n">myones</span> <span class="p">)</span>
        <span class="n">modG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modG</span><span class="p">,</span> <span class="n">G</span><span class="o">*</span><span class="n">myones</span> <span class="p">)</span>
        <span class="n">roll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">roll</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">myones</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">dens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dens</span><span class="p">,</span> <span class="n">mydens</span> <span class="p">)</span>

        <span class="c1"># Rest of tower</span>
        <span class="n">towerEID</span> <span class="o">=</span> <span class="n">N1</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">myrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">R_od_tower</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">myones</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">myrange</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">mydens</span>  <span class="o">=</span> <span class="n">m_tower</span> <span class="o">/</span> <span class="n">mytube</span><span class="o">.</span><span class="n">Area</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">z_tower</span><span class="p">)</span> <span class="o">+</span> <span class="n">eps</span>
        <span class="n">N1</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N1</span>  <span class="p">,</span> <span class="n">myrange</span> <span class="o">+</span> <span class="n">towerBeginID</span>    <span class="p">)</span>
        <span class="n">N2</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N2</span>  <span class="p">,</span> <span class="n">myrange</span> <span class="o">+</span> <span class="n">towerBeginID</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">Ax</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ax</span>  <span class="p">,</span> <span class="n">mytube</span><span class="o">.</span><span class="n">Area</span> <span class="p">)</span>
        <span class="n">As</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">As</span>  <span class="p">,</span> <span class="n">mytube</span><span class="o">.</span><span class="n">Asx</span> <span class="p">)</span>
        <span class="n">Jx</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Jx</span>  <span class="p">,</span> <span class="n">mytube</span><span class="o">.</span><span class="n">J0</span> <span class="p">)</span>
        <span class="n">I</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span>   <span class="p">,</span> <span class="n">mytube</span><span class="o">.</span><span class="n">Jxx</span> <span class="p">)</span>
        <span class="n">S</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">S</span>   <span class="p">,</span> <span class="n">mytube</span><span class="o">.</span><span class="n">S</span> <span class="p">)</span>
        <span class="n">C</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">C</span>   <span class="p">,</span> <span class="n">mytube</span><span class="o">.</span><span class="n">C</span> <span class="p">)</span>
        <span class="n">modE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modE</span><span class="p">,</span> <span class="n">E</span><span class="o">*</span><span class="n">myones</span> <span class="p">)</span>
        <span class="n">modG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modG</span><span class="p">,</span> <span class="n">G</span><span class="o">*</span><span class="n">myones</span> <span class="p">)</span>
        <span class="n">roll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">roll</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">myones</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">dens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dens</span><span class="p">,</span> <span class="n">mydens</span> <span class="p">)</span> 

        <span class="c1"># Dummy element</span>
        <span class="n">dummyEID</span> <span class="o">=</span> <span class="n">N1</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">N1</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N1</span>  <span class="p">,</span> <span class="n">towerEndID</span> <span class="p">)</span>
        <span class="n">N2</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N2</span>  <span class="p">,</span> <span class="n">dummyID</span> <span class="p">)</span>
        <span class="n">Ax</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ax</span>  <span class="p">,</span> <span class="n">Ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">As</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">As</span>  <span class="p">,</span> <span class="n">As</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">Jx</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Jx</span>  <span class="p">,</span> <span class="n">Jx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">I</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span>   <span class="p">,</span> <span class="n">I</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">S</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">S</span>   <span class="p">,</span> <span class="n">S</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">C</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">C</span>   <span class="p">,</span> <span class="n">C</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">modE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modE</span><span class="p">,</span> <span class="mf">1e20</span> <span class="p">)</span>
        <span class="n">modG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modG</span><span class="p">,</span> <span class="mf">1e20</span> <span class="p">)</span>
        <span class="n">roll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">roll</span><span class="p">,</span> <span class="mf">0.0</span> <span class="p">)</span>
        <span class="n">dens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dens</span><span class="p">,</span> <span class="mf">1e-6</span> <span class="p">)</span> 
        
        <span class="n">offsetEID</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mytube</span>     <span class="o">=</span> <span class="n">Tube</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">R_od_offset</span><span class="p">,</span> <span class="n">t_wall_offset</span><span class="p">)</span>
        <span class="n">myrange</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">R_od_offset</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">myones</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">myrange</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">mydens</span>     <span class="o">=</span> <span class="n">m_offset</span> <span class="o">/</span> <span class="n">mytube</span><span class="o">.</span><span class="n">Area</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">z_offset</span><span class="p">)</span> <span class="o">+</span> <span class="n">eps</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncolumn</span><span class="p">):</span>
            <span class="n">offsetEID</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">N1</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span>
            
            <span class="n">N1</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N1</span>  <span class="p">,</span> <span class="n">myrange</span> <span class="o">+</span> <span class="n">offsetLowerID</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>    <span class="p">)</span>
            <span class="n">N2</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N2</span>  <span class="p">,</span> <span class="n">myrange</span> <span class="o">+</span> <span class="n">offsetLowerID</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">Ax</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ax</span>  <span class="p">,</span> <span class="n">mytube</span><span class="o">.</span><span class="n">Area</span> <span class="p">)</span>
            <span class="n">As</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">As</span>  <span class="p">,</span> <span class="n">mytube</span><span class="o">.</span><span class="n">Asx</span> <span class="p">)</span>
            <span class="n">Jx</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Jx</span>  <span class="p">,</span> <span class="n">mytube</span><span class="o">.</span><span class="n">J0</span> <span class="p">)</span>
            <span class="n">I</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span>   <span class="p">,</span> <span class="n">mytube</span><span class="o">.</span><span class="n">Jxx</span> <span class="p">)</span>
            <span class="n">S</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">S</span>   <span class="p">,</span> <span class="n">mytube</span><span class="o">.</span><span class="n">S</span> <span class="p">)</span>
            <span class="n">C</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">C</span>   <span class="p">,</span> <span class="n">mytube</span><span class="o">.</span><span class="n">C</span> <span class="p">)</span>
            <span class="n">modE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modE</span><span class="p">,</span> <span class="n">E</span><span class="o">*</span><span class="n">myones</span> <span class="p">)</span>
            <span class="n">modG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modG</span><span class="p">,</span> <span class="n">G</span><span class="o">*</span><span class="n">myones</span> <span class="p">)</span>
            <span class="n">roll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">roll</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">myones</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">dens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dens</span><span class="p">,</span> <span class="n">mydens</span> <span class="p">)</span> <span class="c1"># Mass added below</span>


        <span class="c1"># ---Get element object from frame3dd---</span>
        <span class="n">nelem</span>    <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N1</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="n">frame3dd</span><span class="o">.</span><span class="n">ElementData</span><span class="p">(</span><span class="n">nelem</span><span class="p">,</span> <span class="n">N1</span><span class="p">,</span> <span class="n">N2</span><span class="p">,</span> <span class="n">Ax</span><span class="p">,</span> <span class="n">As</span><span class="p">,</span> <span class="n">As</span><span class="p">,</span> <span class="n">Jx</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">modE</span><span class="p">,</span> <span class="n">modG</span><span class="p">,</span> <span class="n">roll</span><span class="p">,</span> <span class="n">dens</span><span class="p">)</span>

        <span class="c1"># Store data for plotting, also handy for operations below</span>
        <span class="c1">#plotMat = np.zeros((nelem.size, 3, 2))</span>
        <span class="c1">#plotMat[:,:,0] = np.c_[xnode[N1-1], ynode[N1-1], znode[N1-1]]</span>
        <span class="c1">#plotMat[:,:,1] = np.c_[xnode[N2-1], ynode[N2-1], znode[N2-1]]</span>
        <span class="n">plotMat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">mainEID</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">myn1</span> <span class="o">=</span> <span class="n">N1</span><span class="p">[:</span><span class="n">mainEID</span><span class="p">]</span>
        <span class="n">myn2</span> <span class="o">=</span> <span class="n">N2</span><span class="p">[:</span><span class="n">mainEID</span><span class="p">]</span>
        <span class="n">plotMat</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">xnode</span><span class="p">[</span><span class="n">myn1</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ynode</span><span class="p">[</span><span class="n">myn1</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">znode</span><span class="p">[</span><span class="n">myn1</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">plotMat</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">xnode</span><span class="p">[</span><span class="n">myn2</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ynode</span><span class="p">[</span><span class="n">myn2</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">znode</span><span class="p">[</span><span class="n">myn2</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;plot_matrix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotMat</span>
        
        <span class="c1"># Compute length and center of gravity for each element for use below</span>
        <span class="n">elemL</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">plotMat</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">elemCoG</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">plotMat</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># ---Options object---</span>
        <span class="n">shear</span> <span class="o">=</span> <span class="kc">True</span>               <span class="c1"># 1: include shear deformation</span>
        <span class="n">geom</span> <span class="o">=</span> <span class="kc">False</span>               <span class="c1"># 1: include geometric stiffness</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>                    <span class="c1"># x-axis increment for internal forces, -1 to skip</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">frame3dd</span><span class="o">.</span><span class="n">Options</span><span class="p">(</span><span class="n">shear</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>

        <span class="c1"># ---LOAD CASES---</span>
        <span class="c1"># Extreme loading</span>
        <span class="n">gx</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">gy</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">gz</span> <span class="o">=</span> <span class="o">-</span><span class="n">gravity</span>
        <span class="n">load</span> <span class="o">=</span> <span class="n">frame3dd</span><span class="o">.</span><span class="n">StaticLoadCase</span><span class="p">(</span><span class="n">gx</span><span class="p">,</span> <span class="n">gy</span><span class="p">,</span> <span class="n">gz</span><span class="p">)</span>

        <span class="c1"># Wind + Wave loading in local main / offset / tower c.s.</span>
        <span class="n">Px_main</span><span class="p">,</span>    <span class="n">Py_main</span><span class="p">,</span>    <span class="n">Pz_main</span>    <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;main_Pz&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;main_Py&#39;</span><span class="p">],</span> <span class="o">-</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;main_Px&#39;</span><span class="p">]</span>  <span class="c1"># switch to local c.s.</span>
        <span class="n">Px_offset</span><span class="p">,</span> <span class="n">Py_offset</span><span class="p">,</span> <span class="n">Pz_offset</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;offset_Pz&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;offset_Py&#39;</span><span class="p">],</span> <span class="o">-</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;offset_Px&#39;</span><span class="p">]</span>  <span class="c1"># switch to local c.s.</span>
        <span class="n">Px_tower</span><span class="p">,</span>   <span class="n">Py_tower</span><span class="p">,</span>   <span class="n">Pz_tower</span>   <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;tower_Pz&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;tower_Py&#39;</span><span class="p">],</span> <span class="o">-</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;tower_Px&#39;</span><span class="p">]</span>  <span class="c1"># switch to local c.s.</span>
        <span class="n">epsOff</span> <span class="o">=</span> <span class="mf">1e-5</span>
        <span class="c1"># Get mass right- offsets, stiffeners, tower, rna, etc.</span>
        <span class="c1"># Also account for buoyancy loads</span>
        <span class="c1"># Also apply wind/wave loading as trapezoidal on each element</span>
        <span class="c1"># NOTE: Loading is in local element coordinates 0-L, x is along element</span>
        <span class="c1"># Base</span>
        <span class="n">nrange</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">R_od_main</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">EL</span>      <span class="o">=</span> <span class="n">mainEID</span> <span class="o">+</span> <span class="n">nrange</span>
        <span class="n">Ux</span>      <span class="o">=</span> <span class="n">F_hydro_main</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">z_main</span><span class="p">)</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nrange</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">z_main</span><span class="p">)</span> <span class="o">-</span> <span class="n">epsOff</span>  <span class="c1"># subtract small number b.c. of precision</span>
        <span class="n">wx1</span><span class="p">,</span> <span class="n">wx2</span> <span class="o">=</span> <span class="n">Px_main</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">Px_main</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">wy1</span><span class="p">,</span> <span class="n">wy2</span> <span class="o">=</span> <span class="n">Py_main</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">Py_main</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">wz1</span><span class="p">,</span> <span class="n">wz2</span> <span class="o">=</span> <span class="n">Pz_main</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">Pz_main</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="c1"># Tower</span>
        <span class="n">nrange</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">R_od_tower</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">EL</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EL</span><span class="p">,</span> <span class="n">towerEID</span> <span class="o">+</span> <span class="n">nrange</span><span class="p">)</span>
        <span class="n">Ux</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ux</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nrange</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="n">x1</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nrange</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="n">x2</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">z_tower</span><span class="p">)</span> <span class="o">-</span> <span class="n">epsOff</span><span class="p">)</span>
        <span class="n">wx1</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wx1</span><span class="p">,</span> <span class="n">Px_tower</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">wx2</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wx2</span><span class="p">,</span> <span class="n">Px_tower</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">wy1</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wy1</span><span class="p">,</span> <span class="n">Py_tower</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">wy2</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wy2</span><span class="p">,</span> <span class="n">Py_tower</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">wz1</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wz1</span><span class="p">,</span> <span class="n">Pz_tower</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">wz2</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wz2</span><span class="p">,</span> <span class="n">Pz_tower</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="c1"># Buoyancy- offset columns</span>
        <span class="n">nrange</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">R_od_offset</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncolumn</span><span class="p">):</span>
            <span class="n">EL</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EL</span><span class="p">,</span> <span class="n">offsetEID</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">nrange</span><span class="p">)</span>
            <span class="n">Ux</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ux</span><span class="p">,</span>  <span class="n">F_hydro_offset</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">z_offset</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">x1</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nrange</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
            <span class="n">x2</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">z_offset</span><span class="p">)</span> <span class="o">-</span> <span class="n">epsOff</span><span class="p">)</span>
            <span class="n">wx1</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wx1</span><span class="p">,</span> <span class="n">Px_offset</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">wx2</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wx2</span><span class="p">,</span> <span class="n">Px_offset</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="n">wy1</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wy1</span><span class="p">,</span> <span class="n">Py_offset</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">wy2</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wy2</span><span class="p">,</span> <span class="n">Py_offset</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="n">wz1</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wz1</span><span class="p">,</span> <span class="n">Pz_offset</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">wz2</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wz2</span><span class="p">,</span> <span class="n">Pz_offset</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            
        <span class="c1"># Add mass of main and offset columns while we&#39;ve already done the element enumeration</span>
        <span class="n">Uz</span> <span class="o">=</span> <span class="n">Uy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Ux</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">xx1</span> <span class="o">=</span> <span class="n">xy1</span> <span class="o">=</span> <span class="n">xz1</span> <span class="o">=</span> <span class="n">x1</span>
        <span class="n">xx2</span> <span class="o">=</span> <span class="n">xy2</span> <span class="o">=</span> <span class="n">xz2</span> <span class="o">=</span> <span class="n">x2</span>
        <span class="n">load</span><span class="o">.</span><span class="n">changeTrapezoidalLoads</span><span class="p">(</span><span class="n">EL</span><span class="p">,</span> <span class="n">xx1</span><span class="p">,</span> <span class="n">xx2</span><span class="p">,</span> <span class="n">wx1</span><span class="p">,</span> <span class="n">wx2</span><span class="p">,</span> <span class="n">xy1</span><span class="p">,</span> <span class="n">xy2</span><span class="p">,</span> <span class="n">wy1</span><span class="p">,</span> <span class="n">wy2</span><span class="p">,</span> <span class="n">xz1</span><span class="p">,</span> <span class="n">xz2</span><span class="p">,</span> <span class="n">wz1</span><span class="p">,</span> <span class="n">wz2</span><span class="p">)</span>

        <span class="c1"># Buoyancy for fully submerged members</span>
        <span class="c1"># Note indices to elemL and elemCoG could include -1, but since there is assumed to be more than 1 column, this is not necessary</span>
        <span class="n">nrange</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ncolumn</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">Frange</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">R_od_pontoon</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rhoWater</span> <span class="o">*</span> <span class="n">gravity</span>
        <span class="n">F_truss</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">z_cb</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,))</span>
        <span class="k">if</span> <span class="n">ncolumn</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">znode</span><span class="p">[</span><span class="n">offsetLowerID</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lowerAttachFlag</span><span class="p">:</span>
                <span class="n">EL</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EL</span><span class="p">,</span> <span class="n">lowerAttachEID</span> <span class="o">+</span> <span class="n">nrange</span><span class="p">)</span>
                <span class="n">Ux</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ux</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nrange</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
                <span class="n">Uy</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Uy</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nrange</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
                <span class="n">Uz</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Uz</span><span class="p">,</span> <span class="n">Frange</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nrange</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
                <span class="n">F_truss</span> <span class="o">+=</span> <span class="n">Frange</span> <span class="o">*</span> <span class="n">elemL</span><span class="p">[</span><span class="n">lowerAttachEID</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ncolumn</span>
                <span class="n">z_cb</span>    <span class="o">+=</span> <span class="n">Frange</span> <span class="o">*</span> <span class="n">elemL</span><span class="p">[</span><span class="n">lowerAttachEID</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ncolumn</span> <span class="o">*</span> <span class="n">elemCoG</span><span class="p">[</span><span class="n">lowerAttachEID</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
            <span class="k">if</span> <span class="n">lowerRingFlag</span><span class="p">:</span>
                <span class="n">EL</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EL</span><span class="p">,</span> <span class="n">lowerRingEID</span> <span class="o">+</span> <span class="n">nrange</span><span class="p">)</span>
                <span class="n">Ux</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ux</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nrange</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
                <span class="n">Uy</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Uy</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nrange</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
                <span class="n">Uz</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Uz</span><span class="p">,</span> <span class="n">Frange</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nrange</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
                <span class="n">F_truss</span> <span class="o">+=</span> <span class="n">Frange</span> <span class="o">*</span> <span class="n">elemL</span><span class="p">[</span><span class="n">lowerRingEID</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ncolumn</span>
                <span class="n">z_cb</span>    <span class="o">+=</span> <span class="n">Frange</span> <span class="o">*</span> <span class="n">elemL</span><span class="p">[</span><span class="n">lowerRingEID</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ncolumn</span> <span class="o">*</span> <span class="n">elemCoG</span><span class="p">[</span><span class="n">lowerRingEID</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">crossAttachFlag</span><span class="p">:</span>
                <span class="n">factor</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">-</span> <span class="n">z_attach_lower</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">znode</span><span class="p">[</span><span class="n">offsetUpperID</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">z_attach_lower</span><span class="p">)</span> <span class="p">)</span>
                <span class="n">EL</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EL</span><span class="p">,</span> <span class="n">crossAttachEID</span> <span class="o">+</span> <span class="n">nrange</span><span class="p">)</span>
                <span class="n">Ux</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ux</span><span class="p">,</span>  <span class="n">factor</span> <span class="o">*</span> <span class="n">Frange</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">cross_angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nrange</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
                <span class="n">Uy</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Uy</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nrange</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
                <span class="n">Uz</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Uz</span><span class="p">,</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">Frange</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">cross_angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nrange</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
                <span class="n">F_truss</span> <span class="o">+=</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">Frange</span> <span class="o">*</span> <span class="n">elemL</span><span class="p">[</span><span class="n">crossAttachEID</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ncolumn</span>
                <span class="n">z_cb</span>    <span class="o">+=</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">Frange</span> <span class="o">*</span> <span class="n">elemL</span><span class="p">[</span><span class="n">crossAttachEID</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ncolumn</span> <span class="o">*</span> <span class="n">elemCoG</span><span class="p">[</span><span class="n">crossAttachEID</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
            <span class="k">if</span> <span class="n">outerCrossFlag</span><span class="p">:</span>
                <span class="n">factor</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">-</span> <span class="n">znode</span><span class="p">[</span><span class="n">mainLowerID</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">znode</span><span class="p">[</span><span class="n">offsetUpperID</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">znode</span><span class="p">[</span><span class="n">mainLowerID</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>
                <span class="c1"># TODO: This one will take a little more math</span>
                <span class="c1">#EL       = np.append(EL, outerCrossEID + np.arange(2*ncolumn, dtype=np.int32))</span>
                <span class="c1">#Ux       = np.append(Ux, np.zeros(nrange.shape))</span>
                <span class="c1">#Uy       = np.append(Uy, np.zeros(nrange.shape))</span>
                <span class="c1">#Uz       = np.append(Uz, factor * Frange * np.ones(nrange.shape))</span>
                <span class="n">F_truss</span> <span class="o">+=</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">Frange</span> <span class="o">*</span> <span class="n">elemL</span><span class="p">[</span><span class="n">outerCrossEID</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ncolumn</span>
                <span class="n">z_cb</span>    <span class="o">+=</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">Frange</span> <span class="o">*</span> <span class="n">elemL</span><span class="p">[</span><span class="n">outerCrossEID</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ncolumn</span> <span class="o">*</span> <span class="n">elemCoG</span><span class="p">[</span><span class="n">outerCrossEID</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
        <span class="k">if</span> <span class="n">ncolumn</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">znode</span><span class="p">[</span><span class="n">offsetUpperID</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">upperAttachFlag</span><span class="p">:</span>
                <span class="n">EL</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EL</span><span class="p">,</span> <span class="n">upperAttachEID</span> <span class="o">+</span> <span class="n">nrange</span><span class="p">)</span>
                <span class="n">Ux</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ux</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nrange</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
                <span class="n">Uy</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Uy</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nrange</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
                <span class="n">Uz</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Uz</span><span class="p">,</span> <span class="n">Frange</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nrange</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
                <span class="n">F_truss</span> <span class="o">+=</span> <span class="n">Frange</span> <span class="o">*</span> <span class="n">elemL</span><span class="p">[</span><span class="n">upperAttachEID</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ncolumn</span>
                <span class="n">z_cb</span>    <span class="o">+=</span> <span class="n">Frange</span> <span class="o">*</span> <span class="n">elemL</span><span class="p">[</span><span class="n">upperAttachEID</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ncolumn</span> <span class="o">*</span> <span class="n">elemCoG</span><span class="p">[</span><span class="n">upperAttachEID</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
            <span class="k">if</span> <span class="n">upperRingFlag</span><span class="p">:</span>
                <span class="n">EL</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EL</span><span class="p">,</span> <span class="n">upperRingEID</span> <span class="o">+</span> <span class="n">nrange</span><span class="p">)</span>
                <span class="n">Ux</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ux</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nrange</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
                <span class="n">Uy</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Uy</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nrange</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
                <span class="n">Uz</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Uz</span><span class="p">,</span> <span class="n">Frange</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nrange</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
                <span class="n">F_truss</span> <span class="o">+=</span> <span class="n">Frange</span> <span class="o">*</span> <span class="n">elemL</span><span class="p">[</span><span class="n">upperRingEID</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ncolumn</span>
                <span class="n">z_cb</span>    <span class="o">+=</span> <span class="n">Frange</span> <span class="o">*</span> <span class="n">elemL</span><span class="p">[</span><span class="n">upperRingEID</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ncolumn</span> <span class="o">*</span> <span class="n">elemCoG</span><span class="p">[</span><span class="n">upperRingEID</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
        <span class="c1"># Now do fairlead supports</span>
        <span class="n">nrange</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_connect</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">Frange</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">R_od_fairlead</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rhoWater</span> <span class="o">*</span> <span class="n">gravity</span>
        <span class="n">EL</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EL</span><span class="p">,</span> <span class="n">mooringEID</span> <span class="o">+</span> <span class="n">nrange</span><span class="p">)</span>
        <span class="n">Ux</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ux</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nrange</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="n">Uy</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Uy</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nrange</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="n">Uz</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Uz</span><span class="p">,</span> <span class="n">Frange</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nrange</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="n">F_truss</span> <span class="o">+=</span> <span class="n">Frange</span> <span class="o">*</span> <span class="n">elemL</span><span class="p">[</span><span class="n">mooringEID</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_connect</span>
        <span class="n">z_cb</span>    <span class="o">+=</span> <span class="n">Frange</span> <span class="o">*</span> <span class="n">elemL</span><span class="p">[</span><span class="n">mooringEID</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_connect</span> <span class="o">*</span> <span class="n">elemCoG</span><span class="p">[</span><span class="n">mooringEID</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
        <span class="c1"># Finally add in all the uniform loads on buoyancy</span>
        <span class="n">load</span><span class="o">.</span><span class="n">changeUniformLoads</span><span class="p">(</span><span class="n">EL</span><span class="p">,</span> <span class="n">Ux</span><span class="p">,</span> <span class="n">Uy</span><span class="p">,</span> <span class="n">Uz</span><span class="p">)</span>

        <span class="c1"># Point loading for rotor thrust and mooring lines</span>
        <span class="c1"># Point loads for mooring loading</span>
        <span class="n">nnode_connect</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fairleadID</span><span class="p">)</span>
        <span class="n">nF</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fairleadID</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">Fx</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nnode_connect</span><span class="p">)</span>
        <span class="n">Fy</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nnode_connect</span><span class="p">)</span>
        <span class="n">Fz</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nnode_connect</span><span class="p">)</span>
        <span class="n">Mxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nnode_connect</span><span class="p">)</span>
        <span class="n">Myy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nnode_connect</span><span class="p">)</span>
        <span class="n">Mzz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nnode_connect</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_connect</span><span class="p">):</span>
            <span class="n">iline</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">nnode_connect</span><span class="o">==</span><span class="mi">1</span> <span class="k">else</span> <span class="n">k</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="n">n_lines</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_lines</span><span class="p">)</span>
            <span class="n">Fx</span><span class="p">[</span><span class="n">iline</span><span class="p">]</span> <span class="o">+=</span> <span class="n">F_mooring</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">Fy</span><span class="p">[</span><span class="n">iline</span><span class="p">]</span> <span class="o">+=</span> <span class="n">F_mooring</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">Fz</span><span class="p">[</span><span class="n">iline</span><span class="p">]</span> <span class="o">+=</span> <span class="n">F_mooring</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="c1"># Note: extra momemt from mass accounted for below</span>
        <span class="n">nF</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nF</span> <span class="p">,</span> <span class="n">towerEndID</span><span class="p">)</span>
        <span class="n">Fx</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Fx</span> <span class="p">,</span> <span class="n">F_rna</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">Fy</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Fy</span> <span class="p">,</span> <span class="n">F_rna</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">Fz</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Fz</span> <span class="p">,</span> <span class="n">F_rna</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">Mxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Mxx</span><span class="p">,</span> <span class="n">M_rna</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">Myy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Myy</span><span class="p">,</span> <span class="n">M_rna</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">Mzz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Mzz</span><span class="p">,</span> <span class="n">M_rna</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">)</span>
        
        <span class="c1"># Add in all point loads</span>
        <span class="n">load</span><span class="o">.</span><span class="n">changePointLoads</span><span class="p">(</span><span class="n">nF</span><span class="p">,</span> <span class="n">Fx</span><span class="p">,</span> <span class="n">Fy</span><span class="p">,</span> <span class="n">Fz</span><span class="p">,</span> <span class="n">Mxx</span><span class="p">,</span> <span class="n">Myy</span><span class="p">,</span> <span class="n">Mzz</span><span class="p">)</span>



        <span class="c1"># ---MASS SUMMARIES---</span>
        <span class="c1"># Mass summaries now that we&#39;ve tabulated all of the pontoons</span>
        <span class="k">if</span> <span class="n">mainEID</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># Have some pontoons or fairlead supports</span>
            <span class="c1"># Buoyancy assembly from incremental calculations above</span>
            <span class="n">V_pontoon</span> <span class="o">=</span> <span class="n">F_truss</span><span class="o">/</span><span class="n">rhoWater</span><span class="o">/</span><span class="n">gravity</span>
            <span class="n">z_cb</span>      <span class="o">=</span> <span class="n">z_cb</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">F_truss</span> <span class="k">if</span> <span class="n">F_truss</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="k">else</span> <span class="mf">0.0</span>
            <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;pontoon_displacement&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">V_pontoon</span>
            <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;pontoon_center_of_buoyancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_cb</span>

            <span class="c1"># Sum up mass and compute CofG.  Frame3DD does mass, but not CG</span>
            <span class="c1"># TODO: Subtract out extra pontoon length that overlaps with column radii</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">mainEID</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">m_total</span> <span class="o">=</span> <span class="n">Ax</span><span class="p">[:</span><span class="n">ind</span><span class="p">]</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">elemL</span><span class="p">[:</span><span class="n">ind</span><span class="p">]</span>
            <span class="n">m_pontoon</span> <span class="o">=</span> <span class="n">m_total</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="c1">#mass.struct_mass</span>
            <span class="n">cg_pontoon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">m_total</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">*</span> <span class="n">elemCoG</span><span class="p">[:</span><span class="n">ind</span><span class="p">,:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span> <span class="p">)</span> <span class="o">/</span> <span class="n">m_total</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;pontoon_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m_pontoon</span>
            <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;pontoon_cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">m_pontoon</span>
            <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;pontoon_center_of_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cg_pontoon</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">V_pontoon</span> <span class="o">=</span> <span class="n">z_cb</span> <span class="o">=</span> <span class="n">m_pontoon</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">cg_pontoon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            
        <span class="c1"># Summary of mass and volumes</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;total_displacement&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">V_main</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">ncolumn</span><span class="o">*</span><span class="n">V_offset</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">V_pontoon</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;substructure_mass&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">m_pontoon</span> <span class="o">+</span> <span class="n">m_main</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">ncolumn</span><span class="o">*</span><span class="n">m_offset</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;substructure_center_of_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ncolumn</span><span class="o">*</span><span class="n">m_offset</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">*</span><span class="n">cg_offset</span> <span class="o">+</span> <span class="n">m_main</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">*</span><span class="n">cg_main</span> <span class="o">+</span>
                                                   <span class="n">m_pontoon</span><span class="o">*</span><span class="n">cg_pontoon</span><span class="p">)</span> <span class="o">/</span> <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;substructure_mass&#39;</span><span class="p">]</span>
        <span class="n">m_total</span> <span class="o">=</span> <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;substructure_mass&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">m_rna</span> <span class="o">+</span> <span class="n">m_tower</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;structural_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m_total</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;structure_center_of_mass&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="p">(</span><span class="n">m_rna</span><span class="o">*</span><span class="n">cg_rna</span> <span class="o">+</span> <span class="n">m_tower</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">*</span><span class="n">cg_tower</span> <span class="o">+</span>
                                       <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;substructure_mass&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;substructure_center_of_mass&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">m_total</span>

        <span class="c1"># Find cb (center of buoyancy) for whole system</span>
        <span class="n">z_cb</span> <span class="o">=</span> <span class="p">(</span><span class="n">V_main</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">*</span><span class="n">z_cb_main</span> <span class="o">+</span> <span class="n">ncolumn</span><span class="o">*</span><span class="n">V_offset</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">*</span><span class="n">z_cb_offset</span> <span class="o">+</span> <span class="n">V_pontoon</span><span class="o">*</span><span class="n">z_cb</span><span class="p">)</span> <span class="o">/</span> <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;total_displacement&#39;</span><span class="p">]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;z_center_of_buoyancy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_cb</span>


        <span class="c1"># ---REACTIONS---</span>
        <span class="c1"># Find node closest to CG</span>
        <span class="n">cg_dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">xnode</span><span class="p">,</span> <span class="n">ynode</span><span class="p">,</span> <span class="n">znode</span><span class="p">]</span> <span class="o">-</span> <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;structure_center_of_mass&#39;</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:])</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span> <span class="p">)</span>
        <span class="n">cg_node</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">cg_dist</span><span class="p">)</span>
        <span class="c1"># Free=0, Rigid=1</span>
        <span class="n">rid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mainBeginID</span><span class="p">])</span> <span class="c1">#np.array(fairleadID) #np.array([cg_node+1]) #</span>
        <span class="n">Rx</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">rid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">Ry</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">rid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">Rz</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">rid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">Rxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">rid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">Ryy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">rid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">Rzz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">rid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">rid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rid</span><span class="p">,</span> <span class="n">fairleadID</span><span class="p">)</span>
        <span class="n">Rx</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Rx</span><span class="p">,</span>  <span class="n">K_mooring</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span><span class="n">nnode_connect</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nnode_connect</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">Ry</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ry</span><span class="p">,</span>  <span class="n">K_mooring</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span><span class="n">nnode_connect</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nnode_connect</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">Rz</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Rz</span><span class="p">,</span>  <span class="n">K_mooring</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span><span class="n">nnode_connect</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nnode_connect</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">Rxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Rxx</span><span class="p">,</span>  <span class="n">K_mooring</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">/</span><span class="n">nnode_connect</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nnode_connect</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">Ryy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ryy</span><span class="p">,</span>  <span class="n">K_mooring</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">/</span><span class="n">nnode_connect</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nnode_connect</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">Rzz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Rzz</span><span class="p">,</span>  <span class="n">K_mooring</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">/</span><span class="n">nnode_connect</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nnode_connect</span><span class="p">)</span> <span class="p">)</span>
        <span class="c1"># Get reactions object from frame3dd</span>
        <span class="n">reactions</span> <span class="o">=</span> <span class="n">frame3dd</span><span class="o">.</span><span class="n">ReactionData</span><span class="p">(</span><span class="n">rid</span><span class="p">,</span> <span class="n">Rx</span><span class="p">,</span> <span class="n">Ry</span><span class="p">,</span> <span class="n">Rz</span><span class="p">,</span> <span class="n">Rxx</span><span class="p">,</span> <span class="n">Ryy</span><span class="p">,</span> <span class="n">Rzz</span><span class="p">,</span> <span class="n">rigid</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

        
        <span class="c1"># ---FRAME3DD INSTANCE---</span>

        <span class="c1"># Initialize frame3dd object</span>
        <span class="n">myframe</span> <span class="o">=</span> <span class="n">frame3dd</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">reactions</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        
        <span class="c1"># Add in extra mass of rna</span>
        <span class="n">inode</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">towerEndID</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span> <span class="c1"># rna</span>
        <span class="n">m_extra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">m_rna</span><span class="p">])</span>
        <span class="n">Ixx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">I_rna</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">])</span>
        <span class="n">Iyy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">I_rna</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">])</span>
        <span class="n">Izz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">I_rna</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">])</span>
        <span class="n">Ixy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">I_rna</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="p">])</span>
        <span class="n">Ixz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">I_rna</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="p">])</span>
        <span class="n">Iyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">I_rna</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="p">])</span>
        <span class="n">rhox</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">cg_rna</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">])</span>
        <span class="n">rhoy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">cg_rna</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">])</span>
        <span class="n">rhoz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">cg_rna</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">])</span>
        <span class="n">myframe</span><span class="o">.</span><span class="n">changeExtraNodeMass</span><span class="p">(</span><span class="n">inode</span><span class="p">,</span> <span class="n">m_extra</span><span class="p">,</span> <span class="n">Ixx</span><span class="p">,</span> <span class="n">Iyy</span><span class="p">,</span> <span class="n">Izz</span><span class="p">,</span> <span class="n">Ixy</span><span class="p">,</span> <span class="n">Ixz</span><span class="p">,</span> <span class="n">Iyz</span><span class="p">,</span> <span class="n">rhox</span><span class="p">,</span> <span class="n">rhoy</span><span class="p">,</span> <span class="n">rhoz</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        
        <span class="c1"># Store load case into frame 3dd object</span>
        <span class="n">myframe</span><span class="o">.</span><span class="n">addLoadCase</span><span class="p">(</span><span class="n">load</span><span class="p">)</span>


        <span class="c1"># ---DYNAMIC ANALYSIS---</span>
        <span class="c1"># This needs to be compared to FAST until I trust it enough to use it.</span>
        <span class="c1"># Have to test BCs, results, mooring stiffness, mooring mass/MOI, etc</span>
        <span class="n">nM</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#NFREQ          # number of desired dynamic modes of vibration</span>
        <span class="n">Mmethod</span> <span class="o">=</span> <span class="mi">1</span>         <span class="c1"># 1: subspace Jacobi     2: Stodola</span>
        <span class="n">lump</span> <span class="o">=</span> <span class="mi">0</span>            <span class="c1"># 0: consistent mass ... 1: lumped mass matrix</span>
        <span class="n">tol</span> <span class="o">=</span> <span class="mf">1e-5</span>          <span class="c1"># mode shape tolerance</span>
        <span class="n">shift</span> <span class="o">=</span> <span class="mf">0.0</span>        <span class="c1"># shift value ... for unrestrained or partially restrained structures</span>
        
        <span class="c1">#myframe.enableDynamics(nM, Mmethod, lump, tol, shift)</span>

        <span class="c1"># ---DEBUGGING---</span>
        <span class="c1">#myframe.write(&#39;debug.3dd&#39;) # For debugging</span>

        <span class="c1"># ---RUN ANALYSIS---</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">displacements</span><span class="p">,</span> <span class="n">forces</span><span class="p">,</span> <span class="n">reactions</span><span class="p">,</span> <span class="n">internalForces</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span> <span class="n">modal</span> <span class="o">=</span> <span class="n">myframe</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">bad_input</span><span class="p">()</span>
            <span class="k">return</span>
            
        <span class="c1"># --OUTPUTS--</span>
        <span class="n">nE</span>    <span class="o">=</span> <span class="n">nelem</span><span class="o">.</span><span class="n">size</span>
        <span class="n">iCase</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># natural frequncies- catch nans and zeros</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NFREQ</span><span class="p">)</span> <span class="c1">#np.array( modal.freq )</span>
        <span class="n">temp</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">temp</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;structural_frequencies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">+</span> <span class="n">eps</span>

        <span class="c1"># deflections due to loading (from cylinder top and wind/wave loads)</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;top_deflection&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">displacements</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="n">iCase</span><span class="p">,</span> <span class="n">towerEndID</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># in yaw-aligned direction</span>

        <span class="c1"># Find cg (center of gravity) for whole system</span>
        <span class="n">F_main</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">reactions</span><span class="o">.</span><span class="n">Fx</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">reactions</span><span class="o">.</span><span class="n">Fy</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">reactions</span><span class="o">.</span><span class="n">Fz</span><span class="o">.</span><span class="n">sum</span><span class="p">()])</span>
        <span class="n">M_main</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">reactions</span><span class="o">.</span><span class="n">Mxx</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">reactions</span><span class="o">.</span><span class="n">Myy</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">reactions</span><span class="o">.</span><span class="n">Mzz</span><span class="o">.</span><span class="n">sum</span><span class="p">()])</span>
        <span class="n">r_cg_main</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="p">(</span><span class="n">znode</span><span class="p">[</span><span class="n">mainBeginID</span><span class="p">]</span> <span class="o">-</span> <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;structure_center_of_mass&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])])</span>
        <span class="n">delta</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">r_cg_main</span><span class="p">,</span> <span class="n">F_main</span><span class="p">)</span>

        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;total_force&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">F_main</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;total_moment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">M_main</span> <span class="o">+</span> <span class="n">delta</span>
        <span class="n">myM</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="p">(</span><span class="n">z_tower</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;structure_center_of_mass&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])]),</span> <span class="n">F_rna</span><span class="p">)</span>
        
        <span class="c1"># shear and bending (convert from local to global c.s.)</span>
        <span class="n">Nx</span> <span class="o">=</span> <span class="n">forces</span><span class="o">.</span><span class="n">Nx</span><span class="p">[</span><span class="n">iCase</span><span class="p">,</span> <span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">Vy</span> <span class="o">=</span> <span class="n">forces</span><span class="o">.</span><span class="n">Vy</span><span class="p">[</span><span class="n">iCase</span><span class="p">,</span> <span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">Vz</span> <span class="o">=</span> <span class="n">forces</span><span class="o">.</span><span class="n">Vz</span><span class="p">[</span><span class="n">iCase</span><span class="p">,</span> <span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">Tx</span> <span class="o">=</span> <span class="n">forces</span><span class="o">.</span><span class="n">Txx</span><span class="p">[</span><span class="n">iCase</span><span class="p">,</span> <span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">My</span> <span class="o">=</span> <span class="n">forces</span><span class="o">.</span><span class="n">Myy</span><span class="p">[</span><span class="n">iCase</span><span class="p">,</span> <span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">Mz</span> <span class="o">=</span> <span class="n">forces</span><span class="o">.</span><span class="n">Mzz</span><span class="p">[</span><span class="n">iCase</span><span class="p">,</span> <span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># Compute axial and shear stresses in elements given Frame3DD outputs and some geomtry data</span>
        <span class="c1"># Method comes from Section 7.14 of Frame3DD documentation</span>
        <span class="c1"># http://svn.code.sourceforge.net/p/frame3dd/code/trunk/doc/Frame3DD-manual.html#structuralmodeling</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">My</span><span class="o">*</span><span class="n">My</span> <span class="o">+</span> <span class="n">Mz</span><span class="o">*</span><span class="n">Mz</span><span class="p">)</span>
        <span class="n">sigma_ax</span> <span class="o">=</span> <span class="n">Nx</span><span class="o">/</span><span class="n">Ax</span> <span class="o">-</span> <span class="n">M</span><span class="o">/</span><span class="n">S</span>
        <span class="n">sigma_sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Vy</span><span class="o">*</span><span class="n">Vy</span> <span class="o">+</span> <span class="n">Vz</span><span class="o">*</span><span class="n">Vz</span><span class="p">)</span><span class="o">/</span><span class="n">As</span> <span class="o">+</span> <span class="n">Tx</span><span class="o">/</span><span class="n">C</span>

        <span class="c1"># Extract pontoon for stress check</span>
        <span class="n">idx</span>  <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">mainEID</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">npon</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">qdyn_pontoon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;main_qdyn&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;offset_qdyn&#39;</span><span class="p">]]</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">sigma_ax_pon</span> <span class="o">=</span> <span class="n">sigma_ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">sigma_sh_pon</span> <span class="o">=</span> <span class="n">sigma_sh</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">sigma_h_pon</span>  <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">hoopStress</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">R_od_pontoon</span><span class="p">,</span> <span class="n">t_wall_pontoon</span><span class="p">,</span> <span class="n">qdyn_pontoon</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">sigma_ax_pon</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

            <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;pontoon_stress&#39;</span><span class="p">][:</span><span class="n">npon</span><span class="p">]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">vonMisesStressUtilization</span><span class="p">(</span><span class="n">sigma_ax_pon</span><span class="p">,</span> <span class="n">sigma_h_pon</span><span class="p">,</span> <span class="n">sigma_sh_pon</span><span class="p">,</span>
                                                                               <span class="n">gamma_f</span><span class="o">*</span><span class="n">gamma_m</span><span class="o">*</span><span class="n">gamma_n</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">)</span>
        
        <span class="c1"># Extract tower for Eurocode checks</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">towerEID</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">R_od_tower</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">L_reinforced</span>   <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;tower_buckling_length&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">sigma_ax_tower</span> <span class="o">=</span> <span class="n">sigma_ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">sigma_sh_tower</span> <span class="o">=</span> <span class="n">sigma_sh</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">qdyn_tower</span><span class="p">,</span><span class="n">_</span>   <span class="o">=</span> <span class="n">nodal2sectional</span><span class="p">(</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;tower_qdyn&#39;</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">sigma_h_tower</span>  <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">hoopStress</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">R_od_tower</span><span class="p">,</span> <span class="n">t_wall_tower</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_tower</span><span class="p">),</span> <span class="n">qdyn_tower</span><span class="p">)</span>

        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;tower_stress:axial&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma_ax_tower</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;tower_stress:shear&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma_sh_tower</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;tower_stress:hoop&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">sigma_h_tower</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;tower_stress:hoopStiffen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">hoopStressEurocode</span><span class="p">(</span><span class="n">z_tower</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">R_od_tower</span><span class="p">,</span> <span class="n">t_wall_tower</span><span class="p">,</span> <span class="n">L_reinforced</span><span class="p">,</span> <span class="n">qdyn_tower</span><span class="p">)</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;tower_stress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">vonMisesStressUtilization</span><span class="p">(</span><span class="n">sigma_ax_tower</span><span class="p">,</span> <span class="n">sigma_h_tower</span><span class="p">,</span> <span class="n">sigma_sh_tower</span><span class="p">,</span>
                                                                  <span class="n">gamma_f</span><span class="o">*</span><span class="n">gamma_m</span><span class="o">*</span><span class="n">gamma_n</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">)</span>

        <span class="n">sigma_y_vec</span> <span class="o">=</span> <span class="n">sigma_y</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;tower_shell_buckling&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">shellBucklingEurocode</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">R_od_tower</span><span class="p">,</span> <span class="n">t_wall_tower</span><span class="p">,</span> <span class="n">sigma_ax_tower</span><span class="p">,</span> <span class="n">sigma_h_tower</span><span class="p">,</span> <span class="n">sigma_sh_tower</span><span class="p">,</span>
                                                                      <span class="n">L_reinforced</span><span class="p">,</span> <span class="n">modE</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">sigma_y_vec</span><span class="p">,</span> <span class="n">gamma_f</span><span class="p">,</span> <span class="n">gamma_b</span><span class="p">)</span>

        <span class="n">tower_height</span> <span class="o">=</span> <span class="n">z_tower</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">z_tower</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;tower_global_buckling&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">bucklingGL</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">R_od_tower</span><span class="p">,</span> <span class="n">t_wall_tower</span><span class="p">,</span> <span class="n">Nx</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">M</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">tower_height</span><span class="p">,</span> <span class="n">modE</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">sigma_y_vec</span><span class="p">,</span> <span class="n">gamma_f</span><span class="p">,</span> <span class="n">gamma_b</span><span class="p">)</span>

        
        <span class="c1"># Extract main column for Eurocode checks</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">mainEID</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">R_od_main</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">L_reinforced</span>  <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;main_buckling_length&#39;</span><span class="p">]</span>
        <span class="n">sigma_ax_main</span> <span class="o">=</span> <span class="n">sigma_ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">sigma_sh_main</span> <span class="o">=</span> <span class="n">sigma_sh</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">qdyn_main</span><span class="p">,</span><span class="n">_</span>   <span class="o">=</span> <span class="n">nodal2sectional</span><span class="p">(</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;main_qdyn&#39;</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">sigma_h_main</span>  <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">hoopStress</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">R_od_main</span><span class="p">,</span> <span class="n">t_wall_main</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_main</span><span class="p">),</span> <span class="n">qdyn_main</span><span class="p">)</span>

        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;main_stress:axial&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma_ax_main</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;main_stress:shear&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma_sh_main</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;main_stress:hoop&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">sigma_h_main</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;main_stress:hoopStiffen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">hoopStressEurocode</span><span class="p">(</span><span class="n">z_main</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">R_od_main</span><span class="p">,</span> <span class="n">t_wall_main</span><span class="p">,</span> <span class="n">L_reinforced</span><span class="p">,</span> <span class="n">qdyn_main</span><span class="p">)</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;main_stress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">vonMisesStressUtilization</span><span class="p">(</span><span class="n">sigma_ax_main</span><span class="p">,</span> <span class="n">sigma_h_main</span><span class="p">,</span> <span class="n">sigma_sh_main</span><span class="p">,</span>
                                                                        <span class="n">gamma_f</span><span class="o">*</span><span class="n">gamma_m</span><span class="o">*</span><span class="n">gamma_n</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">)</span>

        <span class="n">sigma_y_vec</span> <span class="o">=</span> <span class="n">sigma_y</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;main_shell_buckling&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">shellBucklingEurocode</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">R_od_main</span><span class="p">,</span> <span class="n">t_wall_main</span><span class="p">,</span> <span class="n">sigma_ax_main</span><span class="p">,</span> <span class="n">sigma_h_main</span><span class="p">,</span> <span class="n">sigma_sh_main</span><span class="p">,</span>
                                                                            <span class="n">L_reinforced</span><span class="p">,</span> <span class="n">modE</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">sigma_y_vec</span><span class="p">,</span> <span class="n">gamma_f</span><span class="p">,</span> <span class="n">gamma_b</span><span class="p">)</span>

        <span class="n">main_height</span> <span class="o">=</span> <span class="n">z_main</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">z_main</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;main_global_buckling&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">bucklingGL</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">R_od_main</span><span class="p">,</span> <span class="n">t_wall_main</span><span class="p">,</span> <span class="n">Nx</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">M</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">main_height</span><span class="p">,</span> <span class="n">modE</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">sigma_y_vec</span><span class="p">,</span> <span class="n">gamma_f</span><span class="p">,</span> <span class="n">gamma_b</span><span class="p">)</span>

        
        <span class="c1"># Extract offset column for Eurocode checks</span>
        <span class="k">if</span> <span class="n">ncolumn</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">offsetEID</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">R_od_offset</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
            <span class="n">L_reinforced</span>     <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;offset_buckling_length&#39;</span><span class="p">]</span>
            <span class="n">sigma_ax_offset</span> <span class="o">=</span> <span class="n">sigma_ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">sigma_sh_offset</span> <span class="o">=</span> <span class="n">sigma_sh</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">qdyn_offset</span><span class="p">,</span><span class="n">_</span>   <span class="o">=</span> <span class="n">nodal2sectional</span><span class="p">(</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;offset_qdyn&#39;</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">sigma_h_offset</span>  <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">hoopStress</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">R_od_offset</span><span class="p">,</span> <span class="n">t_wall_offset</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_offset</span><span class="p">),</span> <span class="n">qdyn_offset</span><span class="p">)</span>

            <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;offset_stress:axial&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma_ax_offset</span>
            <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;offset_stress:shear&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma_sh_offset</span>
            <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;offset_stress:hoop&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">sigma_h_offset</span>
            <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;offset_stress:hoopStiffen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">hoopStressEurocode</span><span class="p">(</span><span class="n">z_offset</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">R_od_offset</span><span class="p">,</span> <span class="n">t_wall_offset</span><span class="p">,</span> <span class="n">L_reinforced</span><span class="p">,</span> <span class="n">qdyn_offset</span><span class="p">)</span>
            <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;offset_stress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">vonMisesStressUtilization</span><span class="p">(</span><span class="n">sigma_ax_offset</span><span class="p">,</span> <span class="n">sigma_h_offset</span><span class="p">,</span> <span class="n">sigma_sh_offset</span><span class="p">,</span>
                                                                            <span class="n">gamma_f</span><span class="o">*</span><span class="n">gamma_m</span><span class="o">*</span><span class="n">gamma_n</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">)</span>

            <span class="n">sigma_y_vec</span> <span class="o">=</span> <span class="n">sigma_y</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;offset_shell_buckling&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">shellBucklingEurocode</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">R_od_offset</span><span class="p">,</span> <span class="n">t_wall_offset</span><span class="p">,</span> <span class="n">sigma_ax_offset</span><span class="p">,</span> <span class="n">sigma_h_offset</span><span class="p">,</span> <span class="n">sigma_sh_offset</span><span class="p">,</span>
                                                                                <span class="n">L_reinforced</span><span class="p">,</span> <span class="n">modE</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">sigma_y_vec</span><span class="p">,</span> <span class="n">gamma_f</span><span class="p">,</span> <span class="n">gamma_b</span><span class="p">)</span>

            <span class="n">offset_height</span> <span class="o">=</span> <span class="n">z_offset</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">z_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;offset_global_buckling&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">bucklingGL</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">R_od_offset</span><span class="p">,</span> <span class="n">t_wall_offset</span><span class="p">,</span> <span class="n">Nx</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">M</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">offset_height</span><span class="p">,</span> <span class="n">modE</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">sigma_y_vec</span><span class="p">,</span> <span class="n">gamma_f</span><span class="p">,</span> <span class="n">gamma_b</span><span class="p">)</span></div>
        
        <span class="c1"># TODO: FATIGUE</span>
        <span class="c1"># Base and offset columns get API stress/buckling checked in Column Group because that takes into account stiffeners</span>



<div class="viewcode-block" id="TrussIntegerToBoolean"><a class="viewcode-back" href="../../package.html#floatingse.loading.TrussIntegerToBoolean">[docs]</a><span class="k">class</span> <span class="nc">TrussIntegerToBoolean</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TrussIntegerToBoolean</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;cross_attachment_pontoons_int&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Inclusion of pontoons that connect the bottom of the central main to the tops of the outer offset columns&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;lower_attachment_pontoons_int&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Inclusion of pontoons that connect the central main to the outer offset columns at their bottoms&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;upper_attachment_pontoons_int&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Inclusion of pontoons that connect the central main to the outer offset columns at their tops&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;lower_ring_pontoons_int&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Inclusion of pontoons that ring around outer offset columns at their bottoms&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;upper_ring_pontoons_int&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Inclusion of pontoons that ring around outer offset columns at their tops&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;outer_cross_pontoons_int&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Inclusion of pontoons that ring around outer offset columns at their tops&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;cross_attachment_pontoons&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Inclusion of pontoons that connect the bottom of the central main to the tops of the outer offset columns&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;lower_attachment_pontoons&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Inclusion of pontoons that connect the central main to the outer offset columns at their bottoms&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;upper_attachment_pontoons&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Inclusion of pontoons that connect the central main to the outer offset columns at their tops&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;lower_ring_pontoons&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Inclusion of pontoons that ring around outer offset columns at their bottoms&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;upper_ring_pontoons&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Inclusion of pontoons that ring around outer offset columns at their tops&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;outer_cross_pontoons&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Inclusion of pontoons that ring around outer offset columns at their tops&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">solve_nonlinear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;cross_attachment_pontoons&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;cross_attachment_pontoons_int&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;lower_attachment_pontoons&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;lower_attachment_pontoons_int&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;upper_attachment_pontoons&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;upper_attachment_pontoons_int&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;lower_ring_pontoons&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;lower_ring_pontoons_int&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;upper_ring_pontoons&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;upper_ring_pontoons_int&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;outer_cross_pontoons&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;outer_cross_pontoons_int&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span></div>

        
<span class="c1"># -----------------</span>
<span class="c1">#  Assembly</span>
<span class="c1"># -----------------</span>

<div class="viewcode-block" id="Loading"><a class="viewcode-back" href="../../package.html#floatingse.loading.Loading">[docs]</a><span class="k">class</span> <span class="nc">Loading</span><span class="p">(</span><span class="n">Group</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nSection</span><span class="p">,</span> <span class="n">nFull</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Loading</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        
        <span class="c1"># Independent variables that are unique to TowerSE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;main_pontoon_attach_lower&#39;</span><span class="p">,</span>  <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;main_pontoon_attach_lower&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;main_pontoon_attach_upper&#39;</span><span class="p">,</span>  <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;main_pontoon_attach_upper&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;pontoon_outer_diameter&#39;</span><span class="p">,</span>     <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;pontoon_outer_diameter&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;pontoon_wall_thickness&#39;</span><span class="p">,</span>     <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;pontoon_wall_thickness&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;outer_cross_pontoons_int&#39;</span><span class="p">,</span>       <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;outer_cross_pontoons_int&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;cross_attachment_pontoons_int&#39;</span><span class="p">,</span>  <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;cross_attachment_pontoons_int&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;lower_attachment_pontoons_int&#39;</span><span class="p">,</span>  <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;lower_attachment_pontoons_int&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;upper_attachment_pontoons_int&#39;</span><span class="p">,</span>  <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;upper_attachment_pontoons_int&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;lower_ring_pontoons_int&#39;</span><span class="p">,</span>        <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;lower_ring_pontoons_int&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;upper_ring_pontoons_int&#39;</span><span class="p">,</span>        <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;upper_ring_pontoons_int&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;pontoon_cost_rate&#39;</span><span class="p">,</span>          <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;pontoon_cost_rate&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;connection_ratio_max&#39;</span><span class="p">,</span>       <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;connection_ratio_max&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;fairlead_support_outer_diameter&#39;</span><span class="p">,</span>     <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;fairlead_support_outer_diameter&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;fairlead_support_wall_thickness&#39;</span><span class="p">,</span>     <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;fairlead_support_wall_thickness&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>

        <span class="c1"># All the components</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;loadingWind&#39;</span><span class="p">,</span> <span class="n">PowerWind</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;z0&#39;</span><span class="p">,</span><span class="s1">&#39;Uref&#39;</span><span class="p">,</span><span class="s1">&#39;shearExp&#39;</span><span class="p">,</span><span class="s1">&#39;zref&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;windLoads&#39;</span><span class="p">,</span> <span class="n">CylinderWindDrag</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cd_usr&#39;</span><span class="p">,</span><span class="s1">&#39;beta&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;intbool&#39;</span><span class="p">,</span> <span class="n">TrussIntegerToBoolean</span><span class="p">(),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;frame&#39;</span><span class="p">,</span> <span class="n">FloatingFrame</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        
        <span class="c1"># Connections for geometry and mass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;loadingWind.z&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;windLoads.z&#39;</span><span class="p">,</span> <span class="s1">&#39;tower_z_full&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;windLoads.d&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;tower_d_full&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;loadingWind.U&#39;</span><span class="p">,</span> <span class="s1">&#39;windLoads.U&#39;</span><span class="p">)</span>

        <span class="c1"># connections to distLoads1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;windLoads.windLoads_Px&#39;</span><span class="p">,</span> <span class="s1">&#39;tower_Px&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;windLoads.windLoads_Py&#39;</span><span class="p">,</span> <span class="s1">&#39;tower_Py&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;windLoads.windLoads_Pz&#39;</span><span class="p">,</span> <span class="s1">&#39;tower_Pz&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;windLoads.windLoads_qdyn&#39;</span><span class="p">,</span> <span class="s1">&#39;tower_qdyn&#39;</span><span class="p">)</span></div>

</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../../index.html">FloatingSE 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, NREL.
      Last updated on Oct 08, 2018.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.6.
    </div>
  </body>
</html>